<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุตูุญุฉ ุงูุฅุฏุงุฑุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-6">
        <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                <div class="text-center mb-8">
                    <svg class="w-20 h-20 mx-auto text-red-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                    <h2 class="text-3xl font-bold text-gray-800">ุชุณุฌูู ุฏุฎูู ุงูุฅุฏุงุฑุฉ</h2>
                    <p class="text-gray-600 mt-2">ูููุฏูุฑูู ููุท</p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</label>
                        <input type="email" id="adminEmail" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-red-600 focus:outline-none text-lg" placeholder="admin@example.com">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">ูููุฉ ุงูุณุฑ:</label>
                        <input type="password" id="adminPassword" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-red-600 focus:outline-none text-lg" placeholder="โขโขโขโขโขโขโขโข">
                    </div>
                    
                    <button onclick="adminLogin()" class="w-full bg-red-600 text-white py-3 rounded-lg text-xl font-bold hover:bg-red-700 transition-colors">ุฏุฎูู</button>
                    
                    <a href="index.html" class="block text-center text-gray-600 hover:text-gray-800 mt-4">ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
                </div>
            </div>
        </div>

        <div id="adminPanel" class="hidden">
            <div class="bg-gradient-to-r from-red-600 to-red-800 text-white p-6 rounded-lg shadow-lg mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold">ุตูุญุฉ ุงูุฅุฏุงุฑุฉ</h1>
                        <p class="mt-2">ุฅุฏุงุฑุฉ ุงููุธุงู ูุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ</p>
                    </div>
                    <button onclick="adminLogout()" class="bg-white text-red-600 px-6 py-2 rounded-lg font-bold hover:bg-gray-100">ุฎุฑูุฌ</button>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ุงุณู ุงููุฑูุฒ</h2>
                <div class="flex gap-4">
                    <input type="text" id="centerName" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg" placeholder="ุงุณู ุงููุฑูุฒ ุงูุทุจู">
                    <button onclick="saveCenterName()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">ุญูุธ</button>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ุงูุดุฑูุท ุงูุฅุฎุจุงุฑู</h2>
                <div class="space-y-4">
                    <input type="text" id="newsContent" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="ูุญุชูู ุงูุดุฑูุท ุงูุฅุฎุจุงุฑู">
                    <div class="flex gap-4 items-center">
                        <label class="text-gray-700">ุณุฑุนุฉ ุงูุชุญุฑู:</label>
                        <input type="number" id="newsSpeed" class="px-4 py-2 border border-gray-300 rounded-lg w-32" value="50" min="10" max="200">
                        <span class="text-gray-600">ุจูุณู/ุซุงููุฉ</span>
                        <button onclick="saveNews()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 mr-auto">ุญูุธ</button>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ูุฏุฉ ุนุฑุถ ุงูุชูุจูู</h2>
                <div class="flex gap-4 items-center">
                    <input type="number" id="alertDuration" class="px-4 py-2 border border-gray-300 rounded-lg w-32" value="5" min="1" max="60">
                    <span class="text-gray-600">ุซุงููุฉ</span>
                    <button onclick="saveAlertDuration()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">ุญูุธ</button>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ุงูุชูุธูู ุงูุชููุงุฆู ููุจูุงูุงุช</h2>
                <div class="space-y-4">
                    <div class="flex items-center gap-4">
                        <input type="checkbox" id="autoCleanup" class="w-5 h-5">
                        <label for="autoCleanup" class="text-gray-700 font-bold">ุชูุนูู ุงูุชูุธูู ุงูุชููุงุฆู ุงููููู</label>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-700 mb-2">ุนูุฏ ุงูุชูุนููุ ุณูุชู ุชููุงุฆูุงู ูู ููุชุตู ุงูููู:</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                            <li>ุญุฐู ุงููุฏุงุกุงุช ุงูุฃูุฏู ูู 24 ุณุงุนุฉ</li>
                            <li>ุญุฐู ุงูุชูุจููุงุช ุงูุฃูุฏู ูู 24 ุณุงุนุฉ</li>
                            <li>ุงูุงุญุชูุงุธ ุจุงูุนูุงุฏุงุช ูุงูุฃุทุจุงุก ูุงูุฅุนุฏุงุฏุงุช</li>
                        </ul>
                    </div>
                    <button onclick="saveAutoCleanup()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ุฅุนุฏุงุฏุงุช ุงูุตูุช ูุงูููุฏูู</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">ูุณุงุฑ ูููุงุช ุงูุตูุช:</label>
                        <input type="text" id="audioPath" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="audio/">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ูุณุงุฑ ูููุงุช ุงูููุฏูู:</label>
                        <input type="text" id="videoPath" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="media/">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ูุงุฆูุฉ ุงูููุฏูููุงุช (ูู ููุฏูู ูู ุณุทุฑ):</label>
                        <textarea id="videoList" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg font-mono" placeholder="video1.mp4&#10;video2.mp4&#10;video3.mp4"></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ุงุณุชุฎุฏุงู ูุณุงุฑ ุฏุงุฎูู (Android TV):</label>
                        <div class="flex items-center gap-2 mb-2">
                            <input type="checkbox" id="useLocalVideos" class="w-4 h-4">
                            <label for="useLocalVideos" class="text-sm text-gray-600">ุชูุนูู ุงููุตูู ูููููุงุช ุงููุญููุฉ</label>
                        </div>
                        <input type="text" id="localVideoPath" class="w-full px-4 py-2 border border-gray-300 rounded-lg mt-2" placeholder="/sdcard/Videos/">
                        <p class="text-xs text-gray-500 mt-1">ูุซุงู: /sdcard/Videos/ ุฃู /storage/emulated/0/Videos/</p>
                    </div>
                </div>
                <div class="mt-4">
                    <button onclick="saveMediaSettings()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ุงูุชุญูู ุจูุดุบู ุงูููุฏูู (ุฌููุน ุงูุดุงุดุงุช)</h2>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <button onclick="videoControl('previous')" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 font-bold">
                        โฎ๏ธ ุงูุณุงุจู
                    </button>
                    <button onclick="videoControl('play')" class="bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 font-bold">
                        โถ๏ธ ุชุดุบูู
                    </button>
                    <button onclick="videoControl('pause')" class="bg-yellow-600 text-white px-4 py-3 rounded-lg hover:bg-yellow-700 font-bold">
                        โธ๏ธ ุฅููุงู
                    </button>
                    <button onclick="videoControl('next')" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 font-bold">
                        โญ๏ธ ุงูุชุงูู
                    </button>
                    <button onclick="videoControl('mute')" class="bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 font-bold">
                        ๐ ูุชู
                    </button>
                </div>
                <div class="mt-4">
                    <label class="block text-gray-700 font-bold mb-2">ูุณุชูู ุงูุตูุช:</label>
                    <div class="flex gap-4 items-center">
                        <input type="range" id="videoVolumeControl" min="0" max="100" value="50" class="flex-1" onchange="setVideoVolume(this.value)">
                        <span id="videoVolumeDisplay" class="text-gray-700 font-bold w-16">50%</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">ุญุฌูุฒุงุช ุงูููุงุนูุฏ (ุฃูููุงูู)</h2>
                    <button onclick="loadAppointments()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700">๐ ุชุญุฏูุซ ุงููุงุฆูุฉ</button>
                </div>
                
                <div class="flex gap-4 mb-4">
                    <input type="date" id="filterDate" class="px-4 py-2 border border-gray-300 rounded-lg" onchange="loadAppointments()">
                    <select id="filterStatusBooking" class="px-4 py-2 border border-gray-300 rounded-lg" onchange="loadAppointments()">
                        <option value="">ูู ุงูุญุงูุงุช</option>
                        <option value="ูุญุฌูุฒ">ูุญุฌูุฒ</option>
                        <option value="ููุชูู">ููุชูู</option>
                        <option value="ููุบู">ููุบู</option>
                    </select>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-right border-collapse">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3 border">ุงูุงุณู</th>
                                <th class="p-3 border">ุงูุนูุงุฏุฉ</th>
                                <th class="p-3 border">ุงูุชุงุฑูุฎ</th>
                                <th class="p-3 border">ุงูููุช</th>
                                <th class="p-3 border">ุงููุงุชู</th>
                                <th class="p-3 border">ุงูุญุงูุฉ</th>
                                <th class="p-3 border">ุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="appointmentsListTable">
                            <tr><td colspan="7" class="text-center p-4">ุงุถุบุท ุชุญุฏูุซ ูุนุฑุถ ุงูุจูุงูุงุช...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">ุฅุฏุงุฑุฉ ุงูุนูุงุฏุงุช</h2>
                    <button onclick="showAddClinic()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">ุฅุถุงูุฉ ุนูุงุฏุฉ ุฌุฏูุฏุฉ</button>
                </div>
                <div id="clinicsList" class="space-y-3"></div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ุฅุฏุงุฑุฉ ุงูุญุถูุฑ ูุงูุงูุตุฑุงู</h2>
                <div class="mt-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">ุฑูุน ููู Excel ููุญุถูุฑ ุงูุดูุฑู</h3>
                    <div class="flex gap-4">
                        <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg">
                        <button onclick="uploadAttendanceExcel()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-bold">
                            ๐ค ุฑูุน ููู
                        </button>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">* ุงูููู ูุฌุจ ุฃู ูุญุชูู ุนูู ุฃุนูุฏุฉ ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ: doctorId, date, checkIn, checkOut, status</p>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">ุชูุงุฑูุฑ ูุฅุญุตุงุฆูุงุช ุงููุฏุงุก (ุงูููู)</h2>
                    <button onclick="loadStatistics()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700">ุชุญุฏูุซ</button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <p class="text-gray-600 text-sm">ุฅุฌูุงูู ุงููุฏุงุกุงุช</p>
                        <p id="totalCalls" class="text-3xl font-bold text-blue-600">0</p>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4">
                        <p class="text-gray-600 text-sm">ุงูุนูุงุฏุงุช ุงููุดุทุฉ</p>
                        <p id="activeClinics" class="text-3xl font-bold text-green-600">0</p>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-4">
                        <p class="text-gray-600 text-sm">ูุชูุณุท ุงูุงูุชุธุงุฑ (ุฏูููุฉ)</p>
                        <p id="avgWaitTime" class="text-3xl font-bold text-yellow-600">0</p>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4">
                        <p class="text-gray-600 text-sm">ุฃูุซุฑ ุนูุงุฏุฉ ูุดุงุทุงู</p>
                        <p id="mostActiveClinic" class="text-lg font-bold text-purple-600">--</p>
                    </div>
                </div>

                <div id="clinicStatistics" class="space-y-3"></div>

                <div class="mt-6 p-4 bg-red-50 border-l-4 border-red-500 rounded">
                    <h3 class="font-bold text-red-800 mb-2">ุตูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช</h3>
                    <div class="flex gap-2">
                        <button onclick="cleanupOldData('all')" class="bg-red-700 text-white px-4 py-2 rounded-lg hover:bg-red-800 text-sm">
                            ๐๏ธ ุญุฐู ุงูุจูุงูุงุช ุงููุคูุชุฉ ูุงููุฏููุฉ
                        </button>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">ูุฏุงุก ุนููู ูู ุนูุงุฏุฉ:</label>
                        <select id="callClinicSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2"></select>
                        <input type="number" id="callNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2" placeholder="ุฑูู ุงูุนููู">
                        <button onclick="callCustomer()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 w-full">ูุฏุงุก</button>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ุชูุจูู ุนูู ุงูุดุงุดุฉ:</label>
                        <input type="text" id="alertMessage" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2" placeholder="ุฑุณุงูุฉ ุงูุชูุจูู">
                        <button onclick="sendAlert()" class="bg-yellow-600 text-white px-6 py-2 rounded-lg hover:bg-yellow-700 w-full">ุฅุฑุณุงู ุชูุจูู</button>
                    </div>
                    <div>
                       <div class="mt-8">
                        <button onclick="resetAllClinics()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 w-full">ุชุตููุฑ ุฌููุน ุงูุนูุงุฏุงุช</button>
                       </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ุงูุชุญูู ุจุงูุตูุช</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">ุฅุฐุงุนุฉ ููู ุฌุงูุฒ:</label>
                        <select id="instantAudio" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2">
                            <option value="">ุงุฎุชุฑ ููู</option>
                            <option value="instant1.mp3">instant1.mp3</option>
                            <option value="instant2.mp3">instant2.mp3</option>
                            <option value="instant3.mp3">instant3.mp3</option>
                        </select>
                        <button onclick="playInstant()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 w-full">ุชุดุบูู</button>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ุชุณุฌูู ุตูุช:</label>
                        <button id="recordBtn" onclick="toggleRecord()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 w-full mb-2">ุจุฏุก ุงูุชุณุฌูู</button>
                        <button id="playRecordBtn" onclick="playRecording()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 w-full" disabled>ุชุดุบูู ุงูุชุณุฌูู</button>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">ุฅุฏุงุฑุฉ ุงูุฃุทุจุงุก</h2>
                    <button onclick="showAddDoctor()" class="bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700">ุฅุถุงูุฉ ุทุจูุจ ุฌุฏูุฏ</button>
                </div>
                <div id="doctorsList" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <div id="clinicModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-4" id="modalTitle">ุฅุถุงูุฉ ุนูุงุฏุฉ ุฌุฏูุฏุฉ</h3>
            <div class="space-y-4">
                <input type="hidden" id="editClinicId">
                <div>
                    <label class="block text-gray-700 mb-2">ุงุณู ุงูุนูุงุฏุฉ:</label>
                    <input type="text" id="clinicName" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุฑูู ุงูุนูุงุฏุฉ:</label>
                    <input type="number" id="clinicNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุฑูู ุงูุดุงุดุฉ:</label>
                    <div class="grid grid-cols-4 gap-2">
                        <label class="flex items-center gap-2 bg-gray-50 p-2 rounded cursor-pointer"><input type="checkbox" class="clinic-screen-checkbox" value="1"> 1</label>
                        <label class="flex items-center gap-2 bg-gray-50 p-2 rounded cursor-pointer"><input type="checkbox" class="clinic-screen-checkbox" value="2"> 2</label>
                        <label class="flex items-center gap-2 bg-gray-50 p-2 rounded cursor-pointer"><input type="checkbox" class="clinic-screen-checkbox" value="3"> 3</label>
                        <label class="flex items-center gap-2 bg-gray-50 p-2 rounded cursor-pointer"><input type="checkbox" class="clinic-screen-checkbox" value="4"> 4</label>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ูููุฉ ุงูุณุฑ:</label>
                    <input type="password" id="clinicPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div class="flex gap-4">
                    <button onclick="saveClinic()" class="flex-1 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">ุญูุธ</button>
                    <button onclick="closeModal()" class="flex-1 bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">ุฅูุบุงุก</button>
                </div>
            </div>
        </div>
    </div>

    <div id="doctorModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-4" id="doctorModalTitle">ุฅุถุงูุฉ ุทุจูุจ ุฌุฏูุฏ</h3>
            <div class="space-y-4">
                <input type="hidden" id="editDoctorId">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">ุงูุงุณู:</label>
                        <input type="text" id="doctorName" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ุงูููุจ:</label>
                        <input type="text" id="doctorTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="ุฏ. / ุฃ.ุฏ.">
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุงูุนูุงุฏุฉ:</label>
                    <select id="doctorClinic" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></select>
                </div>
                <div class="flex gap-4">
                    <button onclick="saveDoctor()" class="flex-1 bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700">ุญูุธ</button>
                    <button onclick="closeDoctorModal()" class="flex-1 bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">ุฅูุบุงุก</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ุชูููู Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyArFKjBYsFhsPyJPJpjLhH2eSEHlUFEzhI",
            authDomain: "queue-717d5.firebaseapp.com",
            databaseURL: "https://queue-717d5-default-rtdb.firebaseio.com",
            projectId: "queue-717d5",
            storageBucket: "queue-717d5.firebasestorage.app",
            messagingSenderId: "837806460328",
            appId: "1:837806460328:web:f2070b93a2784b1b25619d",
            measurementId: "G-GM30LE46F6"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();
        const firestore = firebase.firestore();
        let currentUser = null;
        let mediaRecorder;
        let recordedChunks = [];
        let recordedBlob;

        // ุงูุชุญูู ูู ุงูุฏุฎูู
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadSettings();
                loadClinics();
                loadDoctors();
                loadAppointments(); // [ุฌุฏูุฏ] ุชุญููู ุงูููุงุนูุฏ
                loadStatistics(); // [ุฌุฏูุฏ] ุชุญููู ุงูุฅุญุตุงุฆูุงุช
            } else {
                currentUser = null;
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('adminPanel').classList.add('hidden');
            }
        });

        // ุฏูุงู ุชุณุฌูู ุงูุฏุฎูู ูุงูุฎุฑูุฌ
        function adminLogin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            if (!email || !password) return alert('ุงูุจูุงูุงุช ูุงูุตุฉ');
            auth.signInWithEmailAndPassword(email, password).catch((e) => alert('ุฎุทุฃ: ' + e.message));
        }

        function adminLogout() {
            if (confirm('ุชุฃููุฏ ุงูุฎุฑูุฌุ')) auth.signOut();
        }

        // ุฅุนุฏุงุฏุงุช ุงููุธุงู
        function loadSettings() {
            db.ref('settings').once('value', (snapshot) => {
                const settings = snapshot.val() || {};
                document.getElementById('centerName').value = settings.centerName || '';
                document.getElementById('newsContent').value = settings.newsContent || '';
                document.getElementById('newsSpeed').value = settings.newsSpeed || 50;
                document.getElementById('alertDuration').value = settings.alertDuration || 5;
                document.getElementById('audioPath').value = settings.audioPath || 'audio/';
                document.getElementById('videoPath').value = settings.videoPath || 'media/';
                
                const vList = settings.videoList || [];
                document.getElementById('videoList').value = Array.isArray(vList) ? vList.join('\n') : vList;
                
                document.getElementById('useLocalVideos').checked = settings.useLocalVideos || false;
                document.getElementById('localVideoPath').value = settings.localVideoPath || '';
            });
        }

        function saveCenterName() {
            db.ref('settings/centerName').set(document.getElementById('centerName').value);
            alert('ุชู ุงูุญูุธ');
        }

        function saveNews() {
            db.ref('settings').update({
                newsContent: document.getElementById('newsContent').value,
                newsSpeed: parseInt(document.getElementById('newsSpeed').value)
            });
            alert('ุชู ุงูุญูุธ');
        }

        function saveAlertDuration() {
            db.ref('settings/alertDuration').set(parseInt(document.getElementById('alertDuration').value));
            alert('ุชู ุงูุญูุธ');
        }

        function saveMediaSettings() {
            const listText = document.getElementById('videoList').value;
            const videoList = listText.split('\n').filter(v => v.trim());
            db.ref('settings').update({
                audioPath: document.getElementById('audioPath').value,
                videoPath: document.getElementById('videoPath').value,
                videoList: videoList,
                useLocalVideos: document.getElementById('useLocalVideos').checked,
                localVideoPath: document.getElementById('localVideoPath').value
            });
            alert('ุชู ุงูุญูุธ');
        }

        // [ุชู ุงูุฅุตูุงุญ] ุงูุชุญูู ุจูุดุบู ุงูููุฏูู
        function videoControl(action) {
            db.ref('video_controls').push({
                action: action,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            // ุชุฃุซูุฑ ุจุตุฑู ุจุณูุท ููุฒุฑ
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'ุชู โ๏ธ';
            setTimeout(() => btn.innerHTML = originalText, 500);
        }

        function setVideoVolume(value) {
            document.getElementById('videoVolumeDisplay').innerText = value + '%';
            db.ref('video_controls').push({
                action: 'volume',
                val: value,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
        }

        // [ุชู ุงูุฅุตูุงุญ] ุญุฌูุฒุงุช ุงูููุงุนูุฏ (ุฃูููุงูู)
        async function loadAppointments() {
            const tableBody = document.getElementById('appointmentsListTable');
            const dateFilter = document.getElementById('filterDate').value;
            const statusFilter = document.getElementById('filterStatusBooking').value;

            tableBody.innerHTML = '<tr><td colspan="7" class="text-center p-4">ุฌุงุฑู ุงูุชุญููู...</td></tr>';

            try {
                let query = firestore.collection('appointments');

                // ุงูููุงุชุฑ
                if (dateFilter) {
                    query = query.where('date', '==', dateFilter);
                } else {
                    // ุงูุชุฑุงุถูุงู ุนุฑุถ ุงูููู
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('filterDate').value = today;
                    query = query.where('date', '==', today);
                }

                if (statusFilter) {
                    query = query.where('status', '==', statusFilter);
                }

                // ููุงุญุธุฉ: ุงูุชุฑุชูุจ ูุญุชุงุฌ Index ูู Firestoreุ ุฅุฐุง ูุดู ุณูุนุฑุถ ุจุฏูู ุชุฑุชูุจ
                const snapshot = await query.orderBy('time', 'asc').get().catch(async (e) => {
                    if (e.code === 'failed-precondition') return await query.get(); // ูุญุงููุฉ ุจุฏูู ุชุฑุชูุจ
                    throw e;
                });

                if (snapshot.empty) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center p-4 text-gray-500">ูุง ุชูุฌุฏ ุญุฌูุฒุงุช</td></tr>';
                    return;
                }

                tableBody.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    let statusColor = 'bg-blue-100 text-blue-800';
                    if (data.status === 'ููุบู') statusColor = 'bg-red-100 text-red-800';
                    if (data.status === 'ููุชูู') statusColor = 'bg-green-100 text-green-800';

                    tableBody.innerHTML += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-3 font-bold">${data.clientName || '-'}</td>
                            <td class="p-3">${data.clinicName || '-'}</td>
                            <td class="p-3">${data.date || '-'}</td>
                            <td class="p-3 text-left dir-ltr">${data.time || '-'}</td>
                            <td class="p-3">${data.phone || '-'}</td>
                            <td class="p-3"><span class="${statusColor} px-2 py-1 rounded text-xs font-bold">${data.status || 'ุฌุฏูุฏ'}</span></td>
                            <td class="p-3 flex gap-2">
                                <button onclick="updateAppointmentStatus('${doc.id}', 'ููุชูู')" class="text-green-600 text-lg" title="ุญุถุฑ">โ</button>
                                <button onclick="updateAppointmentStatus('${doc.id}', 'ููุบู')" class="text-red-600 text-lg" title="ุฅูุบุงุก">โ</button>
                                <button onclick="deleteAppointment('${doc.id}')" class="text-gray-500 text-lg" title="ุญุฐู">๐๏ธ</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error(error);
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center text-red-500">ุญุฏุซ ุฎุทุฃ: ${error.message}</td></tr>`;
            }
        }

        async function updateAppointmentStatus(id, status) {
            if(confirm(`ุชุบููุฑ ุงูุญุงูุฉ ุฅูู ${status}ุ`)) {
                await firestore.collection('appointments').doc(id).update({ status });
                loadAppointments();
            }
        }

        async function deleteAppointment(id) {
            if(confirm('ุญุฐู ููุงุฆูุ')) {
                await firestore.collection('appointments').doc(id).delete();
                loadAppointments();
            }
        }

        // [ุชู ุงูุฅุตูุงุญ] ุฅุญุตุงุฆูุงุช ุงููุฏุงุก
        function loadStatistics() {
            const startOfDay = new Date();
            startOfDay.setHours(0,0,0,0);
            
            db.ref('calls').orderByChild('timestamp').startAt(startOfDay.getTime()).once('value', (snapshot) => {
                const calls = [];
                snapshot.forEach(c => calls.push(c.val()));

                // ุงูุฅุฌูุงูู
                document.getElementById('totalCalls').innerText = calls.length;

                // ุงูุนูุงุฏุงุช ุงููุดุทุฉ ูุงูุฃูุซุฑ ูุดุงุทุงู
                const counts = {};
                calls.forEach(c => counts[c.clinicName] = (counts[c.clinicName] || 0) + 1);
                
                document.getElementById('activeClinics').innerText = Object.keys(counts).length;

                let max = 0, top = '-';
                const listDiv = document.getElementById('clinicStatistics');
                listDiv.innerHTML = '';
                
                for (const [name, count] of Object.entries(counts)) {
                    if (count > max) { max = count; top = name; }
                    listDiv.innerHTML += `
                        <div class="flex justify-between items-center bg-gray-50 p-2 rounded">
                            <span class="font-bold text-gray-700">${name}</span>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded font-bold">${count}</span>
                        </div>`;
                }
                document.getElementById('mostActiveClinic').innerText = top;
                
                // ูุชูุณุท ุงูุงูุชุธุงุฑ (ุชูุฏูุฑู: 5 ุฏูุงุฆู ููู ูุฏุงุก ููุณูู ุนูู ุนุฏุฏ ุงูุนูุงุฏุงุช)
                const avg = calls.length > 0 ? Math.round((calls.length * 5) / (Object.keys(counts).length || 1)) : 0;
                document.getElementById('avgWaitTime').innerText = avg;
            });
        }

        function cleanupOldData(type) {
            if(!confirm('ูู ุฃูุช ูุชุฃูุฏุ ุณูุชู ุญุฐู ุงูุจูุงูุงุช.')) return;
            if(type === 'all' || type === 'calls') db.ref('calls').remove();
            if(type === 'all' || type === 'alerts') {
                db.ref('alerts').remove();
                db.ref('controlAlerts').remove();
                db.ref('video_controls').remove();
            }
            alert('ุชู ุงูุชูุธูู');
            loadStatistics();
        }

        // [ุชู ุงูุฅุตูุงุญ] ุฑูุน ููู Excel
        async function uploadAttendanceExcel() {
            const file = document.getElementById('excelFile').files[0];
            if (!file) return alert('ุงุฎุชุฑ ููู Excel');

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                    
                    if (!jsonData.length) return alert('ุงูููู ูุงุฑุบ');

                    const batch = firestore.batch();
                    jsonData.forEach(row => {
                        const ref = firestore.collection('attendance').doc();
                        // ุชุฃูุฏ ุฃู ุฃุณูุงุก ุงูุฃุนูุฏุฉ ูู ููู Excel (date, status, doctorId...)
                        batch.set(ref, {
                            ...row,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });
                    
                    await batch.commit();
                    alert(`ุชู ุฑูุน ${jsonData.length} ุณุฌู ุจูุฌุงุญ`);
                } catch (err) {
                    console.error(err);
                    alert('ุฎุทุฃ ูู ุงูููู: ' + err.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // ุฅุฏุงุฑุฉ ุงูุนูุงุฏุงุช (ุงูุฃุตููุฉ)
        function loadClinics() {
            db.ref('clinics').on('value', (snapshot) => {
                const clinics = snapshot.val() || {};
                const list = document.getElementById('clinicsList');
                const callSelect = document.getElementById('callClinicSelect');
                const alertSelect = document.getElementById('controlAlertClinic');
                const docSelect = document.getElementById('doctorClinic');
                
                list.innerHTML = '';
                [callSelect, alertSelect, docSelect].forEach(s => s.innerHTML = '<option value="">ุงุฎุชุฑ ุนูุงุฏุฉ</option>');
                
                Object.keys(clinics).forEach(id => {
                    const c = clinics[id];
                    const screens = Array.isArray(c.screens) ? c.screens.join(', ') : c.screen;
                    list.innerHTML += `
                        <div class="flex justify-between p-4 bg-gray-50 rounded mb-2">
                            <div><b>${c.name}</b> (ุฑูู ${c.number}) - ุดุงุดุงุช: ${screens}</div>
                            <div>
                                <button onclick="editClinic('${id}')" class="text-blue-600 px-2">ุชุนุฏูู</button>
                                <button onclick="deleteClinic('${id}')" class="text-red-600 px-2">ุญุฐู</button>
                            </div>
                        </div>`;
                    
                    const opt = `<option value="${id}">${c.name}</option>`;
                    callSelect.innerHTML += opt;
                    alertSelect.innerHTML += opt;
                    docSelect.innerHTML += opt;
                });
            });
        }

        function showAddClinic() {
            document.getElementById('modalTitle').innerText = 'ุฅุถุงูุฉ ุนูุงุฏุฉ';
            document.getElementById('editClinicId').value = '';
            document.getElementById('clinicName').value = '';
            document.getElementById('clinicNumber').value = '';
            document.getElementById('clinicPassword').value = '';
            document.querySelectorAll('.clinic-screen-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('clinicModal').classList.remove('hidden');
        }

        function saveClinic() {
            const id = document.getElementById('editClinicId').value;
            const name = document.getElementById('clinicName').value;
            const number = parseInt(document.getElementById('clinicNumber').value);
            const password = document.getElementById('clinicPassword').value;
            const screens = Array.from(document.querySelectorAll('.clinic-screen-checkbox:checked')).map(cb => parseInt(cb.value));

            if (!name || !number || !screens.length) return alert('ุจูุงูุงุช ูุงูุตุฉ');
            const data = { name, number, screens, password, currentNumber: 0, status: 'active' };
            if (id) db.ref('clinics/' + id).update(data);
            else db.ref('clinics').push(data);
            closeModal();
        }

        function editClinic(id) {
            db.ref('clinics/' + id).once('value', s => {
                const c = s.val();
                document.getElementById('editClinicId').value = id;
                document.getElementById('clinicName').value = c.name;
                document.getElementById('clinicNumber').value = c.number;
                document.getElementById('clinicPassword').value = c.password;
                const screens = Array.isArray(c.screens) ? c.screens : [c.screen];
                document.querySelectorAll('.clinic-screen-checkbox').forEach(cb => cb.checked = screens.includes(parseInt(cb.value)));
                document.getElementById('clinicModal').classList.remove('hidden');
            });
        }

        function deleteClinic(id) { if(confirm('ุญุฐูุ')) db.ref('clinics/' + id).remove(); }
        function closeModal() { document.getElementById('clinicModal').classList.add('hidden'); }

        // ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ
        function callCustomer() {
            const id = document.getElementById('callClinicSelect').value;
            const num = parseInt(document.getElementById('callNumber').value);
            if (!id || !num) return;
            db.ref('clinics/' + id).once('value', s => {
                db.ref('calls').push({ clinicId: id, clinicName: s.val().name, number: num, timestamp: Date.now() });
                db.ref('clinics/' + id).update({ currentNumber: num });
            });
        }

        function sendAlert() {
            const msg = document.getElementById('alertMessage').value;
            if(msg) db.ref('alerts').push({ message: msg, timestamp: Date.now() });
        }

        function sendControlAlert() {
            const id = document.getElementById('controlAlertClinic').value;
            const msg = document.getElementById('controlAlertMessage').value;
            if(msg && id) db.ref('controlAlerts').push({ clinicId: id, message: msg, timestamp: Date.now() });
        }

        function resetAllClinics() {
            if(!confirm('ุชุตููุฑ ุงูููุ')) return;
            db.ref('clinics').once('value', s => {
                s.forEach(c => c.ref.update({ currentNumber: 0 }));
            });
        }

        // ุงูุฃุทุจุงุก
        function loadDoctors() {
            db.ref('doctors').on('value', s => {
                const list = document.getElementById('doctorsList');
                list.innerHTML = '';
                s.forEach(doc => {
                    const d = doc.val();
                    list.innerHTML += `
                        <div class="flex justify-between p-4 bg-gray-50 rounded mb-2">
                            <div><b>${d.name}</b> (${d.title})</div>
                            <div>
                                <button onclick="editDoctor('${doc.key}')" class="text-blue-600 px-2">ุชุนุฏูู</button>
                                <button onclick="deleteDoctor('${doc.key}')" class="text-red-600 px-2">ุญุฐู</button>
                            </div>
                        </div>`;
                });
            });
        }

        function showAddDoctor() {
            document.getElementById('doctorModalTitle').innerText = 'ุฅุถุงูุฉ ุทุจูุจ';
            document.getElementById('editDoctorId').value = '';
            document.getElementById('doctorName').value = '';
            document.getElementById('doctorModal').classList.remove('hidden');
        }

        function saveDoctor() {
            const id = document.getElementById('editDoctorId').value;
            const name = document.getElementById('doctorName').value;
            const title = document.getElementById('doctorTitle').value;
            const clinicId = document.getElementById('doctorClinic').value;
            if(!name) return alert('ุงูุงุณู ูุทููุจ');
            
            const data = { name, title, clinicId };
            if(id) db.ref('doctors/' + id).update(data);
            else db.ref('doctors').push(data);
            closeDoctorModal();
        }

        function editDoctor(id) {
            db.ref('doctors/' + id).once('value', s => {
                const d = s.val();
                document.getElementById('editDoctorId').value = id;
                document.getElementById('doctorName').value = d.name;
                document.getElementById('doctorTitle').value = d.title;
                document.getElementById('doctorClinic').value = d.clinicId;
                document.getElementById('doctorModal').classList.remove('hidden');
            });
        }

        function deleteDoctor(id) { if(confirm('ุญุฐูุ')) db.ref('doctors/' + id).remove(); }
        function closeDoctorModal() { document.getElementById('doctorModal').classList.add('hidden'); }

        // ุงูุตูุช
        function playInstant() {
            const file = document.getElementById('instantAudio').value;
            if(file) {
                new Audio('audio/' + file).play();
                db.ref('instantAudio').push({ file, timestamp: Date.now() });
            }
        }

        async function toggleRecord() {
            const btn = document.getElementById('recordBtn');
            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                recordedChunks = [];
                mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    recordedBlob = new Blob(recordedChunks, { type: 'audio/webm' });
                    document.getElementById('playRecordBtn').disabled = false;
                };
                mediaRecorder.start();
                btn.innerText = 'ุฅููุงู';
            } else {
                mediaRecorder.stop();
                btn.innerText = 'ุชุณุฌูู';
            }
        }

        function playRecording() {
            if(recordedBlob) new Audio(URL.createObjectURL(recordedBlob)).play();
        }
    </script>
</body>
</html>
